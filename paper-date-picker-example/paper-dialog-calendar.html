<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-date-picker/paper-date-picker.html">

<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">

<dom-module id="paper-dialog-calendar">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style type="text/css">
      #container {
        position: relative;
        width: 100%;
      }

      #dialog {
        position: absolute;
        top: 0px;
        left: 0px;
      }

      #dateInput {
        float:left;
        display:inline; 
      }
      
    </style>
    <!-- 3. Declare the element. Configure using its attributes. -->
    <!--     {{}} sirve para two-way binding. [[]] sirve para one-way -->

    <div id="container">
      <paper-input id="dateInput" label="Fecha" on-change="inputToDate" value="{{inputValue}}" pattern="\d{4}/\d{2}/\d{2}" error-message="Formato: yyyy/MM/dd" auto-validate></paper-input>
      <paper-button raised id="triggerCalendar">Click</paper-button>

      <paper-dialog id="dialog" class="paper-date-picker-dialog" >
        <paper-date-picker id="calendar"
            date="{{pickerDate}}"
            force-narrow="{{pickerNarrow}}"
            locale="{{pickerLocale}}"
            heading-format="{{pickerHeadingFormat}}"
            max-date="{{pickerMaxDate}}"
            min-date="{{pickerMinDate}}"
            responsive-width="{{pickerResponsiveWidth}}">
        </paper-date-picker>
        <div class="buttons">
          <paper-button dialog-dismiss>Cancel</paper-button>
          <paper-button dialog-confirm>OK</paper-button>
        </div>
      </paper-dialog>
    </div>



  </template>


  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'paper-dialog-calendar',
      properties: {
        pickerDate: {
          type: Date,
          notify: true,
          reflectToAttribute: true,
          observer: '_pickerDateObserver',
          value: new Date()
        },
        /*fuerza formato vertical de calendario en vez de horizontal*/
        pickerNarrow: {
          type: Boolean,
          notify: true,
          reflectToAttribute: true,
          value:true
        },
        /*region de fecha*/
        pickerLocale: {
          type: String,
          notify: true,
          reflectToAttribute: true,
          /*valor por defecto*/
          value: "en"
        },
        /*formato de fecha de encabezado*/
        pickerHeadingFormat: {
          type: String,
          notify: true,
          reflectToAttribute: true,
          /*valor por defecto: d=caracter dia D=numero dia M=caracter mes*/
          value: "ddd D MMM"
        },
        /*fecha maxima permitida de seleccion*/
        pickerMaxDate: {
          type: Date,
          notify: true,
          reflectToAttribute: true,
        },
        /*fecha minima permitida de seleccion*/
        pickerMinDate: {
          type: Date,
          notify: true,
          reflectToAttribute: true,
        },
        /*Maximum screen width at which the picker uses a vertical layout.
        Determina el maximo tamano de la pantalla para el cual el display del calendario sera vertical.*/
        pickerResponsiveWidth: {
          type: String,
          notify: true,
          reflectToAttribute: true,
          value: "560px"
        },
        inputValue: {
          type: String,
          notify: true,
          reflectToAttribute: true,
        },
      },
      ready: function() {
        console.log("READY!");
        var dialog = this.$.dialog;
        this.$.triggerCalendar.onclick = function() {
          console.log("TRIGGER!");
          dialog.toggle();
        }
      },
      _pickerDateObserver: function(newValue, oldValue) {
        if(oldValue && newValue && oldValue.toString() == newValue.toString()){
          return;
        }

        console.log("paper-dialog-calendar pickerDate changed from: " + oldValue + " to: " + newValue);
        this.fire('kick', {kickValue: newValue});
      },
      toggle: function() {
        this.$.dialog.toggle();
      },
      inputToDate: function() {
        if(this.inputValue) {
          try{
            this.pickerDate = new Date(this.inputValue);
          }catch(err) {
            
          }
        }
        console.log("changed!");
      }
    });
  </script>

</dom-module>